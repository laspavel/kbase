# ESXi расширение диска (Datastore)

**vmkfstools -P /vmfs/volumes/old-COMMON_APP/**
```
VMFS-5.60 file system spanning 1 partitions.
File system label (if any): old-COMMON_APP
Mode: public
Capacity 7696312958976 (7339776 file blocks * 1048576), 7695252848640 (7338765 blocks) avail, max file size 69201586814976
UUID: 5badccff-de753e98-c8e8-40f2e9f5072a
Partitions spanned (on "lvm"):
        naa.60050768028112d3780000000000001a:1
Is Native Snapshot Capable: YES
```

**partedUtil get "/vmfs/devices/disks/naa.60050768028112d3780000000000001a"**
```
1069397 255 63 17179869184
1 2048 15032385502 0 0
```

**partedUtil getUsableSectors "/vmfs/devices/disks/naa.60050768028112d3780000000000001a"**

```
Увидели ошибку вида:

Error: The backup GPT table is not at the end of the disk, as it should be.  This might mean that another operating system believes the disk is smaller.  Fix, by moving the backup to the end (and removing the old backup)? This will also fix the last usable sector as per the new size. diskSize (17179869184) AlternateLBA (15032385535) LastUsableLBA (15032385502)
Warning: Not all of the space available to /dev/disks/naa.60050768028112d3780000000000001a appears to be used, you can fix the GPT to use all of the space (an extra 2147483648 blocks) or continue with the current setting? This will also move the backup table at the end if is is not at the end already. diskSize (17179869184) AlternateLBA (15032385535) LastUsableLBA (15032385502) NewLastUsableLBA (17179869150)
34 17179869150
```

Запустили интерактивный FIX:


**partedUtil fixGpt "/vmfs/devices/disks/naa.60050768028112d3780000000000001a"**

```
FixGpt tries to fix any problems detected in GPT table.
Please ensure that you don't run this on any RDM (Raw Device Mapping) disk.
Are you sure you want to continue (Y/N): Y
Error: The backup GPT table is not at the end of the disk, as it should be.  This might mean that another operating system believes the disk is smaller.  Fix, by moving the backup to the end (and removing the old backup)? This will also fix the last usable sector as per the new size. diskSize (17179869184) AlternateLBA (15032385535) LastUsableLBA (15032385502)
Fix/Ignore/Cancel? Fix
gpt
1069397 255 63 17179869184
1 2048 15032385502 AA31E02A400F11DB9590000C2911D1B8 vmfs 0
```

Повторно запускаем:


**partedUtil getUsableSectors "/vmfs/devices/disks/naa.60050768028112d3780000000000001a"**

`34 17179869150`

Запускаем resize:


**partedUtil resize "/vmfs/devices/disks/naa.60050768028112d3780000000000001a" 1 2048 17179869150**

Обновляем информацию о VMFS volumes:


**vmkfstools -V**

Расширяем Datastore:


**vmkfstools --growfs "/vmfs/devices/disks/naa.60050768028112d3780000000000001a:1" "/vmfs/devices/disks/naa.60050768028112d3780000000000001a:1"**

Проверяем - (было Capacity 7696312958976 стало - Capacity 8795824586752):


**vmkfstools -P /vmfs/volumes/old-COMMON_APP/**
```
VMFS-5.60 file system spanning 1 partitions.
File system label (if any): old-COMMON_APP
Mode: public
Capacity 8795824586752 (8388352 file blocks * 1048576), 8794758184960 (8387335 blocks) avail, max file size 69201586814976
UUID: 5badccff-de753e98-c8e8-40f2e9f5072a
Partitions spanned (on "lvm"):
        naa.60050768028112d3780000000000001a:1
Is Native Snapshot Capable: YES
```


---
Источник: [How to expand VMFS datastore from the command line (CLI) on vSphere 5.x and 6.x?](https://www.settlersoman.com/how-to-expand-vmfs-datastore-from-the-command-line-cli-on-vsphere-5-x-and-6-x/)
